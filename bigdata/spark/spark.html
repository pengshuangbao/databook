<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spark | 编程手册</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="苍穹浩渺,取之须臾">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.225a8ff9.css" as="style"><link rel="preload" href="/assets/js/app.0f56a723.js" as="script"><link rel="preload" href="/assets/js/4.a8ef5668.js" as="script"><link rel="preload" href="/assets/js/120.42120fe1.js" as="script"><link rel="preload" href="/assets/js/11.0473ae06.js" as="script"><link rel="prefetch" href="/assets/js/10.06cc4fbb.js"><link rel="prefetch" href="/assets/js/100.79e96d05.js"><link rel="prefetch" href="/assets/js/101.bcac0b9f.js"><link rel="prefetch" href="/assets/js/102.c5d92a95.js"><link rel="prefetch" href="/assets/js/103.697856ab.js"><link rel="prefetch" href="/assets/js/104.8f2db4d2.js"><link rel="prefetch" href="/assets/js/105.d4f2bb07.js"><link rel="prefetch" href="/assets/js/106.1a533c3f.js"><link rel="prefetch" href="/assets/js/107.b2845ea0.js"><link rel="prefetch" href="/assets/js/108.226e46ed.js"><link rel="prefetch" href="/assets/js/109.0de9c16c.js"><link rel="prefetch" href="/assets/js/110.4657c34b.js"><link rel="prefetch" href="/assets/js/111.3409d3a7.js"><link rel="prefetch" href="/assets/js/112.a46b486c.js"><link rel="prefetch" href="/assets/js/113.ba001fa9.js"><link rel="prefetch" href="/assets/js/114.ad1e6ba1.js"><link rel="prefetch" href="/assets/js/115.a0ac732f.js"><link rel="prefetch" href="/assets/js/116.4ee2a7b2.js"><link rel="prefetch" href="/assets/js/117.a76fd29a.js"><link rel="prefetch" href="/assets/js/118.83c5badf.js"><link rel="prefetch" href="/assets/js/119.09fec567.js"><link rel="prefetch" href="/assets/js/12.286e979d.js"><link rel="prefetch" href="/assets/js/121.9d79a9dd.js"><link rel="prefetch" href="/assets/js/122.f71a459c.js"><link rel="prefetch" href="/assets/js/123.b75308dc.js"><link rel="prefetch" href="/assets/js/124.e4d4643b.js"><link rel="prefetch" href="/assets/js/125.73fc990d.js"><link rel="prefetch" href="/assets/js/126.3b0eccd0.js"><link rel="prefetch" href="/assets/js/127.3eb3ab27.js"><link rel="prefetch" href="/assets/js/128.64ba68bb.js"><link rel="prefetch" href="/assets/js/129.82cfac7a.js"><link rel="prefetch" href="/assets/js/13.7207d991.js"><link rel="prefetch" href="/assets/js/130.42811f32.js"><link rel="prefetch" href="/assets/js/131.6f498e16.js"><link rel="prefetch" href="/assets/js/132.f0cc9ad2.js"><link rel="prefetch" href="/assets/js/133.325e755a.js"><link rel="prefetch" href="/assets/js/134.076a808c.js"><link rel="prefetch" href="/assets/js/135.fad7be83.js"><link rel="prefetch" href="/assets/js/136.042fc555.js"><link rel="prefetch" href="/assets/js/137.b67b55bc.js"><link rel="prefetch" href="/assets/js/138.6476c99f.js"><link rel="prefetch" href="/assets/js/139.ad07500f.js"><link rel="prefetch" href="/assets/js/14.a1cb7c1b.js"><link rel="prefetch" href="/assets/js/140.3edd2237.js"><link rel="prefetch" href="/assets/js/141.5181db27.js"><link rel="prefetch" href="/assets/js/142.67b4c4a2.js"><link rel="prefetch" href="/assets/js/143.9d249a3f.js"><link rel="prefetch" href="/assets/js/144.e6db5540.js"><link rel="prefetch" href="/assets/js/145.5b4305a7.js"><link rel="prefetch" href="/assets/js/146.bc674178.js"><link rel="prefetch" href="/assets/js/147.964ff3df.js"><link rel="prefetch" href="/assets/js/148.570b6864.js"><link rel="prefetch" href="/assets/js/149.4b9796c2.js"><link rel="prefetch" href="/assets/js/15.3cafda64.js"><link rel="prefetch" href="/assets/js/150.c677bf4b.js"><link rel="prefetch" href="/assets/js/151.b8977c93.js"><link rel="prefetch" href="/assets/js/152.535e2db4.js"><link rel="prefetch" href="/assets/js/153.754fc05e.js"><link rel="prefetch" href="/assets/js/154.5a5928b6.js"><link rel="prefetch" href="/assets/js/155.19893ca5.js"><link rel="prefetch" href="/assets/js/156.da1f2665.js"><link rel="prefetch" href="/assets/js/157.cb7b551f.js"><link rel="prefetch" href="/assets/js/158.f5d94a11.js"><link rel="prefetch" href="/assets/js/159.0b2b78d9.js"><link rel="prefetch" href="/assets/js/16.54ab9242.js"><link rel="prefetch" href="/assets/js/160.c2548b6c.js"><link rel="prefetch" href="/assets/js/161.8f694ed1.js"><link rel="prefetch" href="/assets/js/162.1adc1aa4.js"><link rel="prefetch" href="/assets/js/163.5688827c.js"><link rel="prefetch" href="/assets/js/164.8442474f.js"><link rel="prefetch" href="/assets/js/165.d0e21e5c.js"><link rel="prefetch" href="/assets/js/166.2e90ae99.js"><link rel="prefetch" href="/assets/js/167.374185de.js"><link rel="prefetch" href="/assets/js/168.2426769f.js"><link rel="prefetch" href="/assets/js/169.829516d9.js"><link rel="prefetch" href="/assets/js/17.9cad59f9.js"><link rel="prefetch" href="/assets/js/170.db0c4609.js"><link rel="prefetch" href="/assets/js/171.7bdcc41b.js"><link rel="prefetch" href="/assets/js/172.7f7ab109.js"><link rel="prefetch" href="/assets/js/173.c1d51df9.js"><link rel="prefetch" href="/assets/js/174.afa4c5f6.js"><link rel="prefetch" href="/assets/js/175.b46d9dd8.js"><link rel="prefetch" href="/assets/js/176.c38ba756.js"><link rel="prefetch" href="/assets/js/177.ba85b912.js"><link rel="prefetch" href="/assets/js/178.af1a44e8.js"><link rel="prefetch" href="/assets/js/179.e097e164.js"><link rel="prefetch" href="/assets/js/18.3776b09c.js"><link rel="prefetch" href="/assets/js/180.d9d5d80c.js"><link rel="prefetch" href="/assets/js/181.79401f8c.js"><link rel="prefetch" href="/assets/js/182.343db47f.js"><link rel="prefetch" href="/assets/js/183.005841bb.js"><link rel="prefetch" href="/assets/js/19.d0ac1e7f.js"><link rel="prefetch" href="/assets/js/20.e0100fb2.js"><link rel="prefetch" href="/assets/js/21.f59cd52c.js"><link rel="prefetch" href="/assets/js/22.3ecf54da.js"><link rel="prefetch" href="/assets/js/23.2508850b.js"><link rel="prefetch" href="/assets/js/24.0ac10322.js"><link rel="prefetch" href="/assets/js/25.7c3ee156.js"><link rel="prefetch" href="/assets/js/26.7021c42c.js"><link rel="prefetch" href="/assets/js/27.d716476b.js"><link rel="prefetch" href="/assets/js/28.58ebf808.js"><link rel="prefetch" href="/assets/js/29.88c37f6c.js"><link rel="prefetch" href="/assets/js/30.87bc4a91.js"><link rel="prefetch" href="/assets/js/31.a69c2a35.js"><link rel="prefetch" href="/assets/js/32.89f74912.js"><link rel="prefetch" href="/assets/js/33.df886872.js"><link rel="prefetch" href="/assets/js/34.835d0785.js"><link rel="prefetch" href="/assets/js/35.5e38ab06.js"><link rel="prefetch" href="/assets/js/36.5b639051.js"><link rel="prefetch" href="/assets/js/37.bb32ead0.js"><link rel="prefetch" href="/assets/js/38.c2541da0.js"><link rel="prefetch" href="/assets/js/39.3c8f0f06.js"><link rel="prefetch" href="/assets/js/40.4cc077aa.js"><link rel="prefetch" href="/assets/js/41.cbcd81a7.js"><link rel="prefetch" href="/assets/js/42.6d002f78.js"><link rel="prefetch" href="/assets/js/43.3f67c882.js"><link rel="prefetch" href="/assets/js/44.58ce7a4d.js"><link rel="prefetch" href="/assets/js/45.bfb9d6e0.js"><link rel="prefetch" href="/assets/js/46.691097de.js"><link rel="prefetch" href="/assets/js/47.e6b5c9b5.js"><link rel="prefetch" href="/assets/js/48.38159f5c.js"><link rel="prefetch" href="/assets/js/49.e03ce66a.js"><link rel="prefetch" href="/assets/js/5.340b4b76.js"><link rel="prefetch" href="/assets/js/50.7df345cb.js"><link rel="prefetch" href="/assets/js/51.b3eed5d5.js"><link rel="prefetch" href="/assets/js/52.bb282842.js"><link rel="prefetch" href="/assets/js/53.6b21ec8f.js"><link rel="prefetch" href="/assets/js/54.bab98944.js"><link rel="prefetch" href="/assets/js/55.59437904.js"><link rel="prefetch" href="/assets/js/56.18b88131.js"><link rel="prefetch" href="/assets/js/57.b0cbba56.js"><link rel="prefetch" href="/assets/js/58.d9379002.js"><link rel="prefetch" href="/assets/js/59.e8663882.js"><link rel="prefetch" href="/assets/js/6.c48e1ddb.js"><link rel="prefetch" href="/assets/js/60.0a00b724.js"><link rel="prefetch" href="/assets/js/61.cd09980d.js"><link rel="prefetch" href="/assets/js/62.b092ff62.js"><link rel="prefetch" href="/assets/js/63.86482c79.js"><link rel="prefetch" href="/assets/js/64.3c1ee4d2.js"><link rel="prefetch" href="/assets/js/65.0621decf.js"><link rel="prefetch" href="/assets/js/66.cf7a6241.js"><link rel="prefetch" href="/assets/js/67.99e103bc.js"><link rel="prefetch" href="/assets/js/68.b3589f28.js"><link rel="prefetch" href="/assets/js/69.f0932a12.js"><link rel="prefetch" href="/assets/js/7.0f410b85.js"><link rel="prefetch" href="/assets/js/70.0a941773.js"><link rel="prefetch" href="/assets/js/71.3a6c6141.js"><link rel="prefetch" href="/assets/js/72.2299ff58.js"><link rel="prefetch" href="/assets/js/73.544fe8c6.js"><link rel="prefetch" href="/assets/js/74.98219c05.js"><link rel="prefetch" href="/assets/js/75.244a9d80.js"><link rel="prefetch" href="/assets/js/76.cefd9fe2.js"><link rel="prefetch" href="/assets/js/77.59793840.js"><link rel="prefetch" href="/assets/js/78.a7d9a079.js"><link rel="prefetch" href="/assets/js/79.f9ec013d.js"><link rel="prefetch" href="/assets/js/8.269955a4.js"><link rel="prefetch" href="/assets/js/80.b0f2cbe5.js"><link rel="prefetch" href="/assets/js/81.3d245e9a.js"><link rel="prefetch" href="/assets/js/82.061b170d.js"><link rel="prefetch" href="/assets/js/83.d2c42148.js"><link rel="prefetch" href="/assets/js/84.f6f487a4.js"><link rel="prefetch" href="/assets/js/85.c5305650.js"><link rel="prefetch" href="/assets/js/86.0c30a2ef.js"><link rel="prefetch" href="/assets/js/87.d9a99f2e.js"><link rel="prefetch" href="/assets/js/88.03792030.js"><link rel="prefetch" href="/assets/js/89.95684850.js"><link rel="prefetch" href="/assets/js/9.5c3462fb.js"><link rel="prefetch" href="/assets/js/90.185b012e.js"><link rel="prefetch" href="/assets/js/91.d19f0020.js"><link rel="prefetch" href="/assets/js/92.9e7855de.js"><link rel="prefetch" href="/assets/js/93.1ee902df.js"><link rel="prefetch" href="/assets/js/94.4bfab4ad.js"><link rel="prefetch" href="/assets/js/95.5f0b1d15.js"><link rel="prefetch" href="/assets/js/96.bd50a446.js"><link rel="prefetch" href="/assets/js/97.749fd671.js"><link rel="prefetch" href="/assets/js/98.bc09c746.js"><link rel="prefetch" href="/assets/js/99.40f98e75.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.98d8c7d3.js"><link rel="prefetch" href="/assets/js/vendors~notification.5515ddcd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.225a8ff9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">编程手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link router-link-active">
  大数据
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法 
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  架构 
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  计算机 
</a></div><div class="nav-item"><a href="/database/" class="nav-link">
  数据库 
</a></div><div class="nav-item"><a href="/fe/" class="nav-link">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维 " class="dropdown-title"><span class="title">运维 </span> <span class="arrow down"></span></button> <button type="button" aria-label="运维 " class="mobile-dropdown-title"><span class="title">运维 </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><h4>
          分类
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ops/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/ops/bigdata.html" class="nav-link">
  大数据
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/programming/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/programming/scala.html" class="nav-link">
  Scala
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><span class="title">资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="资源" class="mobile-dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          我的书单
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/tech.html" class="nav-link">
  技术类
</a></li><li class="dropdown-subitem"><a href="/book/growth.html" class="nav-link">
  成长类
</a></li></ul></li><li class="dropdown-item"><h4>
          网课
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/geek.html" class="nav-link">
  专栏
</a></li><li class="dropdown-subitem"><a href="/book/video.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/tech.html" class="nav-link">
  大厂面经
</a></li><li class="dropdown-subitem"><a href="/interview/sword-to-offer.html" class="nav-link">
  剑指Offer
</a></li><li class="dropdown-subitem"><a href="/interview/fe.html" class="nav-link">
  前端面经
</a></li><li class="dropdown-subitem"><a href="/interview/interview_guide.html" class="nav-link">
  面试导航
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/study.html" class="nav-link">
  学习笔记
</a></li></ul></li></ul></div></div> <a href="https://github.com/pengshuangbao/databook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link router-link-active">
  大数据
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法 
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  架构 
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  计算机 
</a></div><div class="nav-item"><a href="/database/" class="nav-link">
  数据库 
</a></div><div class="nav-item"><a href="/fe/" class="nav-link">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维 " class="dropdown-title"><span class="title">运维 </span> <span class="arrow down"></span></button> <button type="button" aria-label="运维 " class="mobile-dropdown-title"><span class="title">运维 </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><h4>
          分类
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ops/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/ops/bigdata.html" class="nav-link">
  大数据
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/programming/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/programming/scala.html" class="nav-link">
  Scala
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><span class="title">资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="资源" class="mobile-dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          我的书单
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/tech.html" class="nav-link">
  技术类
</a></li><li class="dropdown-subitem"><a href="/book/growth.html" class="nav-link">
  成长类
</a></li></ul></li><li class="dropdown-item"><h4>
          网课
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/geek.html" class="nav-link">
  专栏
</a></li><li class="dropdown-subitem"><a href="/book/video.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/tech.html" class="nav-link">
  大厂面经
</a></li><li class="dropdown-subitem"><a href="/interview/sword-to-offer.html" class="nav-link">
  剑指Offer
</a></li><li class="dropdown-subitem"><a href="/interview/fe.html" class="nav-link">
  前端面经
</a></li><li class="dropdown-subitem"><a href="/interview/interview_guide.html" class="nav-link">
  面试导航
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/study.html" class="nav-link">
  学习笔记
</a></li></ul></li></ul></div></div> <a href="https://github.com/pengshuangbao/databook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/bigdata/" aria-current="page" class="sidebar-link">大数据</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spark</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigdata/spark/spark-streaming.html" class="sidebar-link">Spark Streaming</a></li><li><a href="/bigdata/spark/spark.html" aria-current="page" class="active sidebar-link">Spark</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata/spark/spark.html#基础知识" class="sidebar-link">基础知识</a></li><li class="sidebar-sub-header"><a href="/bigdata/spark/spark.html#spark-优化" class="sidebar-link">Spark 优化</a></li><li class="sidebar-sub-header"><a href="/bigdata/spark/spark.html#原理" class="sidebar-link">原理</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kylin</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hbase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ClickHouse</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Impala</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kudu</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hive</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/bigdata/zookeeper.html" class="sidebar-link">Zookeeper</a></li><li><a href="/bigdata/solution.html" class="sidebar-link">解决方案</a></li><li><a href="/bigdata/design.html" class="sidebar-link">编程设计</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spark"><a href="#spark" class="header-anchor">#</a> Spark</h1> <p></p><div class="table-of-contents"><ul><li><a href="#基础知识">基础知识</a><ul><li><a href="#spark任务执行与调度组件">Spark任务执行与调度组件</a></li><li><a href="#spark性能优化主要有哪些手段">Spark性能优化主要有哪些手段?</a></li><li><a href="#对于spark你觉得他对于现有大数据的现状的优势和劣势在哪里">对于Spark你觉得他对于现有大数据的现状的优势和劣势在哪里?</a></li><li><a href="#spark的shuffle原理及调优">Spark的Shuffle原理及调优?</a></li><li><a href="#spark如何保证宕机迅速恢复">spark如何保证宕机迅速恢复</a></li><li><a href="#rdd的原理以及持久化原理">RDD的原理以及持久化原理</a></li><li><a href="#spark排序实现流程-reduce端怎么实现的">spark排序实现流程,reduce端怎么实现的；</a></li><li><a href="#spark的特点是什么">Spark的特点是什么</a></li><li><a href="#spark的三种提交模式是什么">Spark的三种提交模式是什么</a></li><li><a href="#spark-实现高可用性-high-availability">spark 实现高可用性：High Availability?</a></li><li><a href="#spark中怎么解决内存泄漏问题">spark中怎么解决内存泄漏问题?</a></li><li><a href="#spark-submit模式yarn-cluster和yarn-client的区别">Spark-submit模式yarn-cluster和yarn-client的区别</a></li><li><a href="#spark运行原理-从提交一个jar到最后返回结果-整个过程">spark运行原理,从提交一个jar到最后返回结果,整个过程</a></li><li><a href="#yarn-cluster">Yarn-Cluster</a></li><li><a href="#yarn-client">Yarn-Client</a></li><li><a href="#spark的stage划分是怎么实现的-拓扑排序-怎么实现-还有什么算法实现">spark的stage划分是怎么实现的?拓扑排序?怎么实现?还有什么算法实现?</a></li><li><a href="#spark-rpc-spark2-0为啥舍弃了akka-而用netty">spark rpc,spark2.0为啥舍弃了akka,而用netty</a></li><li><a href="#spark的各种shuffle-与mapreduce的对比">spark的各种shuffle,与mapreduce的对比;</a></li><li><a href="#spark的各种ha-master的ha-worker的ha-executor的ha-driver的ha-task的ha-在容错的时候对集群或是task有什么影响">spark的各种ha,master的ha,worker的ha,executor的ha,driver的ha,task的ha,在容错的时候对集群或是task有什么影响?</a></li><li><a href="#spark的内存管理机制-spark1-6前后对比分析">spark的内存管理机制,spark1.6前后对比分析</a></li><li><a href="#spark2-0做出了哪些优化-tungsten引擎-cpu与内存两个方面分别说明">spark2.0做出了哪些优化?tungsten引擎?cpu与内存两个方面分别说明</a></li><li><a href="#spark-rdd、dataframe、dataset区别">spark rdd、dataframe、dataset区别</a></li><li><a href="#hashpartitioner与rangepartitioner的实现-以及水塘抽样">HashPartitioner与RangePartitioner的实现,以及水塘抽样；</a></li><li><a href="#spark有哪几种join-使用场景-以及实现原理">spark有哪几种join,使用场景,以及实现原理</a></li><li><a href="#dagschedule、taskschedule、schedulebankend实现原理">dagschedule、taskschedule、schedulebankend实现原理；</a></li><li><a href="#宽依赖、窄依赖的概念-宽依赖、窄依赖的例子-以下图中所指的是何种依赖">宽依赖、窄依赖的概念?宽依赖、窄依赖的例子?以下图中所指的是何种依赖</a></li><li><a href="#spark数据倾斜-怎么定位、怎么解决-阿里">Spark数据倾斜,怎么定位、怎么解决（阿里）；</a></li><li><a href="#spark有哪些组件">spark有哪些组件?</a></li><li><a href="#spark的适用场景">Spark的适用场景</a></li><li><a href="#spark-架构">spark 架构</a></li><li><a href="#spark-task解析">spark task解析?</a></li><li><a href="#spark-集群-100g内存-有两百g文件-去读取-有什么问题">spark  集群 100g内存 有两百g文件,去读取,有什么问题</a></li></ul></li><li><a href="#spark-优化">Spark 优化</a><ul><li><a href="#reducebykey或者aggregatebykey与groupbykey的区别">reduceByKey或者aggregateByKey与groupByKey的区别?</a></li><li><a href="#如何使用高性能的算子">如何使用高性能的算子?</a></li><li><a href="#spark-shuffle-数据倾斜的解决方案">Spark Shuffle 数据倾斜的解决方案</a></li></ul></li><li><a href="#原理">原理</a><ul><li><a href="#spark的任务提交和执行流程详解">Spark的任务提交和执行流程详解</a></li></ul></li></ul></div><p></p> <h2 id="基础知识"><a href="#基础知识" class="header-anchor">#</a> 基础知识</h2> <h3 id="spark任务执行与调度组件"><a href="#spark任务执行与调度组件" class="header-anchor">#</a> Spark任务执行与调度组件</h3> <p><img src="https://static.lovedata.net/IMG_00001.jpeg" alt="image"></p> <h3 id="spark性能优化主要有哪些手段"><a href="#spark性能优化主要有哪些手段" class="header-anchor">#</a> Spark性能优化主要有哪些手段?</h3> <p>1、常规性能调优：分配资源、并行度。。。等</p> <p>2、JVM调优（Java虚拟机）：JVM相关的参数，通常情况下，如果你的硬件配置、基础的JVM的配置，都ok的话，JVM通常不会造成太严重的性能问题；反而更多的是，在troubleshooting中，JVM占了很重要的地位；JVM造成线上的spark作业的运行报错，甚至失败（比如OOM）。</p> <p>3、shuffle调优（相当重要）：spark在执行groupByKey、reduceByKey等操作时的，shuffle环节的调优。这个很重要。shuffle调优，其实对spark作业的性能的影响，是相当之高！！！经验：在spark作业的运行过程中，只要一牵扯到有shuffle的操作，基本上shuffle操作的性能消耗，要占到整个spark作业的50%~90%。10%用来运行map等操作，90%耗费在两个shuffle操作。groupByKey、countByKey。</p> <p>4、spark操作调优（spark算子调优，比较重要）：groupByKey，countByKey或aggregateByKey来重构实现。有些算子的性能，是比其他一些算子的性能要高的。foreachPartition替代foreach。如果一旦遇到合适的情况，效果还是不错的。</p> <p>5、广播大变量</p> <p><a href="https://blog.csdn.net/HANLIPENGHANLIPENG/article/details/78393450" target="_blank" rel="noopener noreferrer">spark性能调优都有哪些方法 - CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://juejin.im/post/5a40b9bcf265da4312812653" target="_blank" rel="noopener noreferrer">spark性能优化 - 掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="对于spark你觉得他对于现有大数据的现状的优势和劣势在哪里"><a href="#对于spark你觉得他对于现有大数据的现状的优势和劣势在哪里" class="header-anchor">#</a> 对于Spark你觉得他对于现有大数据的现状的优势和劣势在哪里?</h3> <p>1.Spark的内存计算 主要体现在哪里？
(a) spark, 相比与map reduce最大的速度提升在于做重复计算时，spark可以重复使用相关的缓存数据，而M/R则会笨拙的不断进行disk i/o.
(b) 为了提高容错性，M/R所有的中间结果都会persist到disk， 而M/R 则默认保存在内存。
2.目前Spark主要存在哪些缺点？
(a) JVM的内存overhead太大，1G的数据通常需要消耗5G的内存  -&gt; Project Tungsten 正试图解决这个问题；
(b) 不同的spark app之间缺乏有效的共享内存机制  -&gt; Project Tachyon 在试图引入分布式的内存管理，这样不同的spark app可以共享缓存的数据</p> <p><a href="https://cloud.tencent.com/developer/article/1074623" target="_blank" rel="noopener noreferrer">spark与hadoop相比，存在哪些缺陷（劣势） - 云+社区 - 腾讯云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="spark的shuffle原理及调优"><a href="#spark的shuffle原理及调优" class="header-anchor">#</a> Spark的Shuffle原理及调优?</h3> <p><a href="https://www.cnblogs.com/bonelee/p/6039469.html" target="_blank" rel="noopener noreferrer">用实例说明Spark stage划分原理 - bonelee - 博客园<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://static.lovedata.net/jpg/2018/6/14/cf900b9cbd52d3a84fd8f04dba7c199f.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/f98a94e948fe9d9b63643db96606fab3.jpg" alt="image"></p> <h3 id="spark如何保证宕机迅速恢复"><a href="#spark如何保证宕机迅速恢复" class="header-anchor">#</a> spark如何保证宕机迅速恢复</h3> <h3 id="rdd的原理以及持久化原理"><a href="#rdd的原理以及持久化原理" class="header-anchor">#</a> RDD的原理以及持久化原理</h3> <p><img src="https://static.lovedata.net/jpg/2018/6/14/e224b35496ac4de184008bbb09894893.jpg" alt="image"></p> <h3 id="spark排序实现流程-reduce端怎么实现的"><a href="#spark排序实现流程-reduce端怎么实现的" class="header-anchor">#</a> spark排序实现流程,reduce端怎么实现的；</h3> <h3 id="spark的特点是什么"><a href="#spark的特点是什么" class="header-anchor">#</a> Spark的特点是什么</h3> <p><a href="https://blog.csdn.net/qq_41455420/article/details/79451722" target="_blank" rel="noopener noreferrer">Spark 特点 - CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>快速
Spark函数（类似于MapReduce）运行的时候，绝大多数的函数是可以在内存里面去迭代的。只有少部分的函数需要落地到磁盘</li> <li>易用性
<ol><li>编写简单，支持80种以上的高级算子，支持多种语言，数据源丰富，可部署在多种集群中</li></ol></li> <li>通用性</li> <li>兼容性</li> <li>容错性高。
<ol><li>Spark引进了弹性分布式数据集RDD (Resilient Distributed Dataset) 的抽象，它是分布在一组节点中的只读对象集合，这些集合是弹性的，如果数据集一部分丢失，则可以根据“血统”（即充许基于数据衍生过程）对它们进行重建。另外在RDD计算时可以通过CheckPoint来实现容错，而CheckPoint有两种方式：CheckPoint Data，和Logging The Updates，用户可以控制采用哪种方式来实现容错。</li></ol></li></ol> <h3 id="spark的三种提交模式是什么"><a href="#spark的三种提交模式是什么" class="header-anchor">#</a> Spark的三种提交模式是什么</h3> <ul><li>local(本地模式)：常用于本地开发测试，本地还分为local单线程和local-cluster多线程;</li> <li>standalone(集群模式)：典型的Mater/slave模式，不过也能看出Master是有单点故障的；Spark支持ZooKeeper来实现 HA</li> <li>on yarn(集群模式)： 运行在 yarn 资源管理器框架之上，由 yarn 负责资源管理，Spark 负责任务调度和计算</li> <li>on mesos(集群模式)： 运行在 mesos 资源管理器框架之上，由 mesos 负责资源管理，Spark 负责任务调度和计算</li> <li>on cloud(集群模式)：比如 AWS 的 EC2，使用这个模式能很方便的访问 Amazon的 S3;Spark 支持多种分布式存储系统：HDFS 和 S3</li></ul> <h3 id="spark-实现高可用性-high-availability"><a href="#spark-实现高可用性-high-availability" class="header-anchor">#</a> spark 实现高可用性：High Availability?</h3> <h3 id="spark中怎么解决内存泄漏问题"><a href="#spark中怎么解决内存泄漏问题" class="header-anchor">#</a> spark中怎么解决内存泄漏问题?</h3> <p><a href="https://blog.csdn.net/yhb315279058/article/details/51035631" target="_blank" rel="noopener noreferrer">Spark面对OOM问题的解决方法及优化总结 - CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="spark-submit模式yarn-cluster和yarn-client的区别"><a href="#spark-submit模式yarn-cluster和yarn-client的区别" class="header-anchor">#</a> Spark-submit模式yarn-cluster和yarn-client的区别</h3> <ol><li>yarn-client用于测试，因为他的Driver运行在本地客户端，会与yarn集群产生较大的网络通信，从而导致网卡流量激增；它的好处在于直接执行时，在本地可以查看到所有的log，方便调试；</li> <li>yarn-cluster用于生产环境，因为Driver运行在NodeManager，相当于一个ApplicationMaster，没有网卡流量激增的问题；缺点在于调试不方便，本地用spark-submit提交后，看不到log，只能通过yarn application_id这种命令来查看，很麻烦</li></ol> <p><img src="https://static.lovedata.net/jpg/2018/7/16/b4e773e7305d67cf7f0f95475565e2b3.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/16/30a73b39fab370ec772c6a768bba0515.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/16/0fe9fe0e348a9ea7c258cdbe806610e7.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/16/87a6250639209f2a955781bfa8c5b8fd.jpg" alt="image"></p> <h3 id="spark运行原理-从提交一个jar到最后返回结果-整个过程"><a href="#spark运行原理-从提交一个jar到最后返回结果-整个过程" class="header-anchor">#</a> spark运行原理,从提交一个jar到最后返回结果,整个过程</h3> <ol><li>用户通过spark-submit脚本提交应用。</li> <li>spark-submit根据用户代码及配置确定使用哪个资源管理器，以及在合适的位置启动driver。</li> <li>driver与集群管理器(如YARN)通信，申请资源以启动executor。</li> <li>集群管理器启动executor。</li> <li>driver进程执行用户的代码，根据程序中定义的transformation和action，进行stage的划分，然后以task的形式发送到executor。（通过DAGScheduler划分stage，通过TaskScheduler和TaskSchedulerBackend来真正申请资源运行task）</li> <li>task在executor中进行计算并保存结果。</li> <li>如果driver中的main()方法执行完成退出，或者调用了SparkContext#stop()，driver会终止executor进程，并且通过集群管理器释放资源。</li></ol> <p><img src="https://static.lovedata.net/jpg/2018/6/25/08c8c49a405cc88b2ad3ec169b09ca18.jpg" alt="image"></p> <h3 id="yarn-cluster"><a href="#yarn-cluster" class="header-anchor">#</a> Yarn-Cluster</h3> <p>步骤一：Client类提交应用到YARN ResourceManager，向RM申请资源作为AM
步骤二：在申请到的机器中启动driver，注册成为AM，并调用用户代码，然后创建SparkContext。（driver是一个逻辑概念，并不实际存在，通过抽象出driver这一层，所有的运行模式都可以说是在driver中调用用户代码了）
步骤三：SparkContext中创建DAGScheduler与YarnClusterScheduler与YarnClusterSchedulerBackend。当在用户代码中遇到action时，即会调用DAGScheduler的runJob，任务开始调度执行。
步骤四：YarnClusterSchedulerBackend在NodeManager上启动Executor
步骤五：Executor启动Task，开始执行任务</p> <p><img src="https://static.lovedata.net/jpg/2018/6/25/db6d9c7a2c79d10b803760d02bccb7f1.jpg" alt="image"></p> <h3 id="yarn-client"><a href="#yarn-client" class="header-anchor">#</a> Yarn-Client</h3> <p><img src="https://static.lovedata.net/jpg/2018/6/25/883bd9e6fef3896ed47d4c4fd942c19b.jpg" alt="image"></p> <p>参考
<a href="https://blog.csdn.net/jediael_lu/article/details/76735217" target="_blank" rel="noopener noreferrer">spark提交应用的全流程分析 - CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="spark的stage划分是怎么实现的-拓扑排序-怎么实现-还有什么算法实现"><a href="#spark的stage划分是怎么实现的-拓扑排序-怎么实现-还有什么算法实现" class="header-anchor">#</a> spark的stage划分是怎么实现的?拓扑排序?怎么实现?还有什么算法实现?</h3> <p>宽依赖就是stage划分的依据</p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/5e1a7fa922dbf6c2d5e646071d1bcb47.jpg" alt="image"></p> <h3 id="spark-rpc-spark2-0为啥舍弃了akka-而用netty"><a href="#spark-rpc-spark2-0为啥舍弃了akka-而用netty" class="header-anchor">#</a> spark rpc,spark2.0为啥舍弃了akka,而用netty</h3> <h3 id="spark的各种shuffle-与mapreduce的对比"><a href="#spark的各种shuffle-与mapreduce的对比" class="header-anchor">#</a> spark的各种shuffle,与mapreduce的对比;</h3> <h3 id="spark的各种ha-master的ha-worker的ha-executor的ha-driver的ha-task的ha-在容错的时候对集群或是task有什么影响"><a href="#spark的各种ha-master的ha-worker的ha-executor的ha-driver的ha-task的ha-在容错的时候对集群或是task有什么影响" class="header-anchor">#</a> spark的各种ha,master的ha,worker的ha,executor的ha,driver的ha,task的ha,在容错的时候对集群或是task有什么影响?</h3> <h3 id="spark的内存管理机制-spark1-6前后对比分析"><a href="#spark的内存管理机制-spark1-6前后对比分析" class="header-anchor">#</a> spark的内存管理机制,spark1.6前后对比分析</h3> <h3 id="spark2-0做出了哪些优化-tungsten引擎-cpu与内存两个方面分别说明"><a href="#spark2-0做出了哪些优化-tungsten引擎-cpu与内存两个方面分别说明" class="header-anchor">#</a> spark2.0做出了哪些优化?tungsten引擎?cpu与内存两个方面分别说明</h3> <h3 id="spark-rdd、dataframe、dataset区别"><a href="#spark-rdd、dataframe、dataset区别" class="header-anchor">#</a> spark rdd、dataframe、dataset区别</h3> <h3 id="hashpartitioner与rangepartitioner的实现-以及水塘抽样"><a href="#hashpartitioner与rangepartitioner的实现-以及水塘抽样" class="header-anchor">#</a> HashPartitioner与RangePartitioner的实现,以及水塘抽样；</h3> <h3 id="spark有哪几种join-使用场景-以及实现原理"><a href="#spark有哪几种join-使用场景-以及实现原理" class="header-anchor">#</a> spark有哪几种join,使用场景,以及实现原理</h3> <h3 id="dagschedule、taskschedule、schedulebankend实现原理"><a href="#dagschedule、taskschedule、schedulebankend实现原理" class="header-anchor">#</a> dagschedule、taskschedule、schedulebankend实现原理；</h3> <p><img src="https://static.lovedata.net/jpg/2018/7/13/0d54689ccc31b5ded3369e8ae9656432.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/5ed17c17f013769c3defd665667653fe.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/c3df67b9b516c6bc25b7d4a70dfabcac.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/30383ea00b1199a91e48deb8b1b9563d.jpg" alt="image"></p> <p>stage 划分</p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/d48db9cdff54eb6cea4e1d9dcf0d7726.jpg" alt="image"></p> <blockquote><p>宽依赖就是认为是Dagd的分界线,或者说根据宽依赖将job分为不同的阶段（stage）</p></blockquote> <p><img src="https://static.lovedata.net/jpg/2018/7/13/37054531f120f5531db40dcf90a03d13.jpg" alt="image"></p> <h3 id="宽依赖、窄依赖的概念-宽依赖、窄依赖的例子-以下图中所指的是何种依赖"><a href="#宽依赖、窄依赖的概念-宽依赖、窄依赖的例子-以下图中所指的是何种依赖" class="header-anchor">#</a> 宽依赖、窄依赖的概念?宽依赖、窄依赖的例子?以下图中所指的是何种依赖</h3> <p><img src="https://static.lovedata.net/jpg/2018/7/4/52cbbb0ea8777f912ef6f6383cc1f5eb.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/4/b2053b3741affbafd63dff5ca58ca0b7.jpg" alt="image"> <img src="https://static.lovedata.net/jpg/2018/6/22/cef170091c377f5f7840ca80a9f9287c.jpg" alt="image"></p> <p><img src="https://static.lovedata.net/jpg/2018/7/13/fddef8da2524d01a32515fd4a69837c9.jpg" alt="image"></p> <h3 id="spark数据倾斜-怎么定位、怎么解决-阿里"><a href="#spark数据倾斜-怎么定位、怎么解决-阿里" class="header-anchor">#</a> Spark数据倾斜,怎么定位、怎么解决（阿里）；</h3> <p><a href="https://www.cnblogs.com/LHWorldBlog/p/8506121.html" target="_blank" rel="noopener noreferrer">spark提交应用的全流程分析 - CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://static.lovedata.net/jpg/2018/6/14/a6f6512145359189c2a4e9f9afac7673.jpg" alt="【Spark篇】---Spark解决数据倾斜问题"></p> <h3 id="spark有哪些组件"><a href="#spark有哪些组件" class="header-anchor">#</a> spark有哪些组件?</h3> <ul><li>master：管理集群和节点，不参与计算。</li> <li>worker：计算节点，进程本身不参与计算，和master汇报。</li> <li>Driver：运行程序的main方法，创建spark context对象。</li> <li>spark context：控制整个application的生命周期，包括dagsheduler和task scheduler等组件。</li> <li>client：用户提交程序的入口。</li></ul> <h3 id="spark的适用场景"><a href="#spark的适用场景" class="header-anchor">#</a> Spark的适用场景</h3> <ul><li>复杂的批量处理（Batch Data Processing），偏重点在于处理海量数据的能力，至于处理速度可忍受，通常的时间可能是在数十分钟到数小时；</li> <li>基于历史数据的交互式查询（Interactive Query），通常的时间在数十秒到数十分钟之间</li> <li>基于实时数据流的数据处理（Streaming Data Processing），通常在数百毫秒到数秒之间</li></ul> <h3 id="spark-架构"><a href="#spark-架构" class="header-anchor">#</a> spark 架构</h3> <p><img src="https://static.lovedata.net/jpg/2018/6/14/a6f6512145359189c2a4e9f9afac7673.jpg" alt="spark基础运行架构"></p> <p><img src="https://static.lovedata.net/jpg/2018/6/14/34668f2bad595ff835fdf0823dfb99c6.jpg" alt="spark结合yarn集群背后的运行流程"></p> <p><img src="https://static.lovedata.net/jpg/2018/6/14/3a907f0488496c7a39fb6bec02966e25.jpg" alt="image"></p> <h3 id="spark-task解析"><a href="#spark-task解析" class="header-anchor">#</a> spark task解析?</h3> <p><img src="https://static.lovedata.net/jpg/2018/7/13/f243b2f1b3fae98fda495c5fc8fb3fea.jpg" alt="image"></p> <h3 id="spark-集群-100g内存-有两百g文件-去读取-有什么问题"><a href="#spark-集群-100g内存-有两百g文件-去读取-有什么问题" class="header-anchor">#</a> spark  集群 100g内存 有两百g文件,去读取,有什么问题</h3> <ol><li><a href="https://blog.csdn.net/asdfsadfasdfsa/article/details/78606365" target="_blank" rel="noopener noreferrer">内存有限的情况下 Spark 如何处理 T 级别的数据 - abcde - CSDN博客 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>只有在用户要求Spark cache该RDD，且storage level要求在内存中cache时，Iterator计算出的结果才会被保留，通过cache manager放入内存池</li></ol> <h2 id="spark-优化"><a href="#spark-优化" class="header-anchor">#</a> Spark 优化</h2> <h3 id="reducebykey或者aggregatebykey与groupbykey的区别"><a href="#reducebykey或者aggregatebykey与groupbykey的区别" class="header-anchor">#</a> reduceByKey或者aggregateByKey与groupByKey的区别?</h3> <p>因为reduceByKey和aggregateByKey算子都会使用用户自定义的函数对每个节点本地的相同key进行预聚合。而groupByKey算子是不会进行预聚合的，全量的数据会在集群的各个节点之间分发和传输，性能相对来说比较差。</p> <p>比如如下两幅图，就是典型的例子，分别基于reduceByKey和groupByKey进行单词计数。其中第一张图是groupByKey的原理图，可以看到，没有进行任何本地聚合时，所有数据都会在集群节点之间传输；第二张图是reduceByKey的原理图，可以看到，每个节点本地的相同key数据，都进行了预聚合，然后才传输到其他节点上进行全局聚合。</p> <p><img src="https://static.lovedata.net/jpg/2018/6/14/31d0199949271ef1641a7be918818fcd.jpg" alt="image"></p> <h3 id="如何使用高性能的算子"><a href="#如何使用高性能的算子" class="header-anchor">#</a> 如何使用高性能的算子?</h3> <ol><li>使用reduceByKey/aggregateByKey替代groupByKey</li> <li>使用mapPartitions替代普通map 可能出现OOM 因为可能一个分区数据量太大</li> <li>使用foreachPartitions替代foreach 比如讲分区数据写入到mysql</li> <li>使用filter之后进行coalesce操作 减少分区的数量</li> <li>使用repartitionAndSortWithinPartitions替代repartition与sort类操作
<ol><li>repartitionAndSortWithinPartitions是Spark官网推荐的一个算子，官方建议，如果需要在repartition重分区之后，还要进行排序，建议直接使用repartitionAndSortWithinPartitions算子。因为该算子可以一边进行重分区的shuffle操作，一边进行排序。shuffle与sort两个操作同时进行，比先shuffle再sort来说，性能可能是要高的。</li></ol></li></ol> <p>参考
<a href="https://tech.meituan.com/spark-tuning-basic.html" target="_blank" rel="noopener noreferrer">Spark性能优化指南——基础篇 -<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="spark-shuffle-数据倾斜的解决方案"><a href="#spark-shuffle-数据倾斜的解决方案" class="header-anchor">#</a> Spark Shuffle 数据倾斜的解决方案</h3> <ol><li>解决方案一：使用Hive ETL预处理数据 适用Hive join</li> <li>解决方案二：过滤少数导致倾斜的key</li> <li>解决方案三：提高shuffle操作的并行度  spark.sql.shuffle.partitions   reduceByKey(1000)</li> <li>解决方案四：两阶段聚合（局部聚合+全局聚合）打随机数，预聚合，然后去掉随机数，在进行全局聚合  适用于聚合类型，如果是join类的shuffle操作，还得用其他的解决方案。
<ol><li><img src="https://static.lovedata.net/jpg/2018/6/14/6d4482e3b2738463ed2ce881be07244b.jpg" alt="image"></li></ol></li> <li>解决方案五：将reduce join转为map join  在对RDD使用join类操作，或者是在Spark SQL中使用join语句时，而且join操作中的一个RDD或表的数据量比较小（比如几百M或者一两G），比较适用此方案。
<ol><li>不使用join算子进行连接操作，而使用Broadcast变量与map类算子实现join操作，进而完全规避掉shuffle类的操作，彻底避免数据倾斜的发生和出现。</li> <li>对join操作导致的数据倾斜，效果非常好，因为根本就不会发生shuffle，也就根本不会发生数据倾斜。  适用场景较少，因为这个方案只适用于一个大表和一个小表的情况</li></ol></li> <li>解决方案六：采样倾斜key并分拆join操作
<ol><li>采样倾斜key并分拆join操作
方案适用场景：两个RDD/Hive表进行join的时候，如果数据量都比较大，无法采用“解决方案五”，那么此时可以看一下两个RDD/Hive表中的key分布情况。如果出现数据倾斜，是因为其中某一个RDD/Hive表中的少数几个key的数据量过大，而另一个RDD/Hive表中的所有key都分布比较均匀，那么采用这个解决方案是比较合适的。
方案实现思路：
对包含少数几个数据量过大的key的那个RDD，通过sample算子采样出一份样本来，然后统计一下每个key的数量，计算出来数据量最大的是哪几个key。
然后将这几个key对应的数据从原来的RDD中拆分出来，形成一个单独的RDD，并给每个key都打上n以内的随机数作为前缀，而不会导致倾斜的大部分key形成另外一个RDD。
接着将需要join的另一个RDD，也过滤出来那几个倾斜key对应的数据并形成一个单独的RDD，将每条数据膨胀成n条数据，这n条数据都按顺序附加一个0~n的前缀，不会导致倾斜的大部分key也形成另外一个RDD。
再将附加了随机前缀的独立RDD与另一个膨胀n倍的独立RDD进行join，此时就可以将原先相同的key打散成n份，分散到多个task中去进行join了。
而另外两个普通的RDD就照常join即可。
最后将两次join的结果使用union算子合并起来即可，就是最终的join结果。
<img src="https://static.lovedata.net/jpg/2018/6/14/de04f1729bec2ba1c5b6569952473d38.jpg" alt="image"></li></ol></li> <li>解决方案七：使用随机前缀和扩容RDD进行join</li></ol> <p><a href="https://tech.meituan.com/spark-tuning-pro.html" target="_blank" rel="noopener noreferrer">Spark性能优化指南——高级篇 -<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h2> <h3 id="spark的任务提交和执行流程详解"><a href="#spark的任务提交和执行流程详解" class="header-anchor">#</a> Spark的任务提交和执行流程详解</h3> <p><a href="https://blog.csdn.net/zhongqi2513/article/details/107051253?spm=1001.2014.3001.5501" target="_blank" rel="noopener noreferrer">Spark的任务提交和执行流程详解_好学若饥，谦卑若愚-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://static.lovedata.net/21-05-28-72da2f166dcd33f95220faa60331d545.png" alt="image"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/pengshuangbao/databook/edit/master/docs/bigdata/spark/spark.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/4/14 16:56:47</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bigdata/spark/spark-streaming.html" class="prev">
        Spark Streaming
      </a></span> <span class="next"><a href="/bigdata/flink/">
        Flink
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.0f56a723.js" defer></script><script src="/assets/js/4.a8ef5668.js" defer></script><script src="/assets/js/120.42120fe1.js" defer></script><script src="/assets/js/11.0473ae06.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二章、类加载子系统 | 编程手册</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="苍穹浩渺,取之须臾">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.225a8ff9.css" as="style"><link rel="preload" href="/assets/js/app.0f56a723.js" as="script"><link rel="preload" href="/assets/js/4.a8ef5668.js" as="script"><link rel="preload" href="/assets/js/149.4b9796c2.js" as="script"><link rel="preload" href="/assets/js/11.0473ae06.js" as="script"><link rel="prefetch" href="/assets/js/10.06cc4fbb.js"><link rel="prefetch" href="/assets/js/100.79e96d05.js"><link rel="prefetch" href="/assets/js/101.bcac0b9f.js"><link rel="prefetch" href="/assets/js/102.c5d92a95.js"><link rel="prefetch" href="/assets/js/103.697856ab.js"><link rel="prefetch" href="/assets/js/104.8f2db4d2.js"><link rel="prefetch" href="/assets/js/105.d4f2bb07.js"><link rel="prefetch" href="/assets/js/106.1a533c3f.js"><link rel="prefetch" href="/assets/js/107.b2845ea0.js"><link rel="prefetch" href="/assets/js/108.226e46ed.js"><link rel="prefetch" href="/assets/js/109.0de9c16c.js"><link rel="prefetch" href="/assets/js/110.4657c34b.js"><link rel="prefetch" href="/assets/js/111.3409d3a7.js"><link rel="prefetch" href="/assets/js/112.a46b486c.js"><link rel="prefetch" href="/assets/js/113.ba001fa9.js"><link rel="prefetch" href="/assets/js/114.ad1e6ba1.js"><link rel="prefetch" href="/assets/js/115.a0ac732f.js"><link rel="prefetch" href="/assets/js/116.4ee2a7b2.js"><link rel="prefetch" href="/assets/js/117.a76fd29a.js"><link rel="prefetch" href="/assets/js/118.83c5badf.js"><link rel="prefetch" href="/assets/js/119.09fec567.js"><link rel="prefetch" href="/assets/js/12.286e979d.js"><link rel="prefetch" href="/assets/js/120.42120fe1.js"><link rel="prefetch" href="/assets/js/121.9d79a9dd.js"><link rel="prefetch" href="/assets/js/122.f71a459c.js"><link rel="prefetch" href="/assets/js/123.b75308dc.js"><link rel="prefetch" href="/assets/js/124.e4d4643b.js"><link rel="prefetch" href="/assets/js/125.73fc990d.js"><link rel="prefetch" href="/assets/js/126.3b0eccd0.js"><link rel="prefetch" href="/assets/js/127.3eb3ab27.js"><link rel="prefetch" href="/assets/js/128.64ba68bb.js"><link rel="prefetch" href="/assets/js/129.82cfac7a.js"><link rel="prefetch" href="/assets/js/13.7207d991.js"><link rel="prefetch" href="/assets/js/130.42811f32.js"><link rel="prefetch" href="/assets/js/131.6f498e16.js"><link rel="prefetch" href="/assets/js/132.f0cc9ad2.js"><link rel="prefetch" href="/assets/js/133.325e755a.js"><link rel="prefetch" href="/assets/js/134.076a808c.js"><link rel="prefetch" href="/assets/js/135.fad7be83.js"><link rel="prefetch" href="/assets/js/136.042fc555.js"><link rel="prefetch" href="/assets/js/137.b67b55bc.js"><link rel="prefetch" href="/assets/js/138.6476c99f.js"><link rel="prefetch" href="/assets/js/139.ad07500f.js"><link rel="prefetch" href="/assets/js/14.a1cb7c1b.js"><link rel="prefetch" href="/assets/js/140.3edd2237.js"><link rel="prefetch" href="/assets/js/141.5181db27.js"><link rel="prefetch" href="/assets/js/142.67b4c4a2.js"><link rel="prefetch" href="/assets/js/143.9d249a3f.js"><link rel="prefetch" href="/assets/js/144.e6db5540.js"><link rel="prefetch" href="/assets/js/145.5b4305a7.js"><link rel="prefetch" href="/assets/js/146.bc674178.js"><link rel="prefetch" href="/assets/js/147.964ff3df.js"><link rel="prefetch" href="/assets/js/148.570b6864.js"><link rel="prefetch" href="/assets/js/15.3cafda64.js"><link rel="prefetch" href="/assets/js/150.c677bf4b.js"><link rel="prefetch" href="/assets/js/151.b8977c93.js"><link rel="prefetch" href="/assets/js/152.535e2db4.js"><link rel="prefetch" href="/assets/js/153.754fc05e.js"><link rel="prefetch" href="/assets/js/154.5a5928b6.js"><link rel="prefetch" href="/assets/js/155.19893ca5.js"><link rel="prefetch" href="/assets/js/156.da1f2665.js"><link rel="prefetch" href="/assets/js/157.cb7b551f.js"><link rel="prefetch" href="/assets/js/158.f5d94a11.js"><link rel="prefetch" href="/assets/js/159.0b2b78d9.js"><link rel="prefetch" href="/assets/js/16.54ab9242.js"><link rel="prefetch" href="/assets/js/160.c2548b6c.js"><link rel="prefetch" href="/assets/js/161.8f694ed1.js"><link rel="prefetch" href="/assets/js/162.1adc1aa4.js"><link rel="prefetch" href="/assets/js/163.5688827c.js"><link rel="prefetch" href="/assets/js/164.8442474f.js"><link rel="prefetch" href="/assets/js/165.d0e21e5c.js"><link rel="prefetch" href="/assets/js/166.2e90ae99.js"><link rel="prefetch" href="/assets/js/167.374185de.js"><link rel="prefetch" href="/assets/js/168.2426769f.js"><link rel="prefetch" href="/assets/js/169.829516d9.js"><link rel="prefetch" href="/assets/js/17.9cad59f9.js"><link rel="prefetch" href="/assets/js/170.db0c4609.js"><link rel="prefetch" href="/assets/js/171.7bdcc41b.js"><link rel="prefetch" href="/assets/js/172.7f7ab109.js"><link rel="prefetch" href="/assets/js/173.c1d51df9.js"><link rel="prefetch" href="/assets/js/174.afa4c5f6.js"><link rel="prefetch" href="/assets/js/175.b46d9dd8.js"><link rel="prefetch" href="/assets/js/176.c38ba756.js"><link rel="prefetch" href="/assets/js/177.ba85b912.js"><link rel="prefetch" href="/assets/js/178.af1a44e8.js"><link rel="prefetch" href="/assets/js/179.e097e164.js"><link rel="prefetch" href="/assets/js/18.3776b09c.js"><link rel="prefetch" href="/assets/js/180.d9d5d80c.js"><link rel="prefetch" href="/assets/js/181.79401f8c.js"><link rel="prefetch" href="/assets/js/182.343db47f.js"><link rel="prefetch" href="/assets/js/183.005841bb.js"><link rel="prefetch" href="/assets/js/19.d0ac1e7f.js"><link rel="prefetch" href="/assets/js/20.e0100fb2.js"><link rel="prefetch" href="/assets/js/21.f59cd52c.js"><link rel="prefetch" href="/assets/js/22.3ecf54da.js"><link rel="prefetch" href="/assets/js/23.2508850b.js"><link rel="prefetch" href="/assets/js/24.0ac10322.js"><link rel="prefetch" href="/assets/js/25.7c3ee156.js"><link rel="prefetch" href="/assets/js/26.7021c42c.js"><link rel="prefetch" href="/assets/js/27.d716476b.js"><link rel="prefetch" href="/assets/js/28.58ebf808.js"><link rel="prefetch" href="/assets/js/29.88c37f6c.js"><link rel="prefetch" href="/assets/js/30.87bc4a91.js"><link rel="prefetch" href="/assets/js/31.a69c2a35.js"><link rel="prefetch" href="/assets/js/32.89f74912.js"><link rel="prefetch" href="/assets/js/33.df886872.js"><link rel="prefetch" href="/assets/js/34.835d0785.js"><link rel="prefetch" href="/assets/js/35.5e38ab06.js"><link rel="prefetch" href="/assets/js/36.5b639051.js"><link rel="prefetch" href="/assets/js/37.bb32ead0.js"><link rel="prefetch" href="/assets/js/38.c2541da0.js"><link rel="prefetch" href="/assets/js/39.3c8f0f06.js"><link rel="prefetch" href="/assets/js/40.4cc077aa.js"><link rel="prefetch" href="/assets/js/41.cbcd81a7.js"><link rel="prefetch" href="/assets/js/42.6d002f78.js"><link rel="prefetch" href="/assets/js/43.3f67c882.js"><link rel="prefetch" href="/assets/js/44.58ce7a4d.js"><link rel="prefetch" href="/assets/js/45.bfb9d6e0.js"><link rel="prefetch" href="/assets/js/46.691097de.js"><link rel="prefetch" href="/assets/js/47.e6b5c9b5.js"><link rel="prefetch" href="/assets/js/48.38159f5c.js"><link rel="prefetch" href="/assets/js/49.e03ce66a.js"><link rel="prefetch" href="/assets/js/5.340b4b76.js"><link rel="prefetch" href="/assets/js/50.7df345cb.js"><link rel="prefetch" href="/assets/js/51.b3eed5d5.js"><link rel="prefetch" href="/assets/js/52.bb282842.js"><link rel="prefetch" href="/assets/js/53.6b21ec8f.js"><link rel="prefetch" href="/assets/js/54.bab98944.js"><link rel="prefetch" href="/assets/js/55.59437904.js"><link rel="prefetch" href="/assets/js/56.18b88131.js"><link rel="prefetch" href="/assets/js/57.b0cbba56.js"><link rel="prefetch" href="/assets/js/58.d9379002.js"><link rel="prefetch" href="/assets/js/59.e8663882.js"><link rel="prefetch" href="/assets/js/6.c48e1ddb.js"><link rel="prefetch" href="/assets/js/60.0a00b724.js"><link rel="prefetch" href="/assets/js/61.cd09980d.js"><link rel="prefetch" href="/assets/js/62.b092ff62.js"><link rel="prefetch" href="/assets/js/63.86482c79.js"><link rel="prefetch" href="/assets/js/64.3c1ee4d2.js"><link rel="prefetch" href="/assets/js/65.0621decf.js"><link rel="prefetch" href="/assets/js/66.cf7a6241.js"><link rel="prefetch" href="/assets/js/67.99e103bc.js"><link rel="prefetch" href="/assets/js/68.b3589f28.js"><link rel="prefetch" href="/assets/js/69.f0932a12.js"><link rel="prefetch" href="/assets/js/7.0f410b85.js"><link rel="prefetch" href="/assets/js/70.0a941773.js"><link rel="prefetch" href="/assets/js/71.3a6c6141.js"><link rel="prefetch" href="/assets/js/72.2299ff58.js"><link rel="prefetch" href="/assets/js/73.544fe8c6.js"><link rel="prefetch" href="/assets/js/74.98219c05.js"><link rel="prefetch" href="/assets/js/75.244a9d80.js"><link rel="prefetch" href="/assets/js/76.cefd9fe2.js"><link rel="prefetch" href="/assets/js/77.59793840.js"><link rel="prefetch" href="/assets/js/78.a7d9a079.js"><link rel="prefetch" href="/assets/js/79.f9ec013d.js"><link rel="prefetch" href="/assets/js/8.269955a4.js"><link rel="prefetch" href="/assets/js/80.b0f2cbe5.js"><link rel="prefetch" href="/assets/js/81.3d245e9a.js"><link rel="prefetch" href="/assets/js/82.061b170d.js"><link rel="prefetch" href="/assets/js/83.d2c42148.js"><link rel="prefetch" href="/assets/js/84.f6f487a4.js"><link rel="prefetch" href="/assets/js/85.c5305650.js"><link rel="prefetch" href="/assets/js/86.0c30a2ef.js"><link rel="prefetch" href="/assets/js/87.d9a99f2e.js"><link rel="prefetch" href="/assets/js/88.03792030.js"><link rel="prefetch" href="/assets/js/89.95684850.js"><link rel="prefetch" href="/assets/js/9.5c3462fb.js"><link rel="prefetch" href="/assets/js/90.185b012e.js"><link rel="prefetch" href="/assets/js/91.d19f0020.js"><link rel="prefetch" href="/assets/js/92.9e7855de.js"><link rel="prefetch" href="/assets/js/93.1ee902df.js"><link rel="prefetch" href="/assets/js/94.4bfab4ad.js"><link rel="prefetch" href="/assets/js/95.5f0b1d15.js"><link rel="prefetch" href="/assets/js/96.bd50a446.js"><link rel="prefetch" href="/assets/js/97.749fd671.js"><link rel="prefetch" href="/assets/js/98.bc09c746.js"><link rel="prefetch" href="/assets/js/99.40f98e75.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.98d8c7d3.js"><link rel="prefetch" href="/assets/js/vendors~notification.5515ddcd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.225a8ff9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">编程手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  Java
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法 
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  架构 
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  计算机 
</a></div><div class="nav-item"><a href="/database/" class="nav-link">
  数据库 
</a></div><div class="nav-item"><a href="/fe/" class="nav-link">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维 " class="dropdown-title"><span class="title">运维 </span> <span class="arrow down"></span></button> <button type="button" aria-label="运维 " class="mobile-dropdown-title"><span class="title">运维 </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><h4>
          分类
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ops/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/ops/bigdata.html" class="nav-link">
  大数据
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/programming/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/programming/scala.html" class="nav-link">
  Scala
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><span class="title">资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="资源" class="mobile-dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          我的书单
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/tech.html" class="nav-link">
  技术类
</a></li><li class="dropdown-subitem"><a href="/book/growth.html" class="nav-link">
  成长类
</a></li></ul></li><li class="dropdown-item"><h4>
          网课
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/geek.html" class="nav-link">
  专栏
</a></li><li class="dropdown-subitem"><a href="/book/video.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/tech.html" class="nav-link">
  大厂面经
</a></li><li class="dropdown-subitem"><a href="/interview/sword-to-offer.html" class="nav-link">
  剑指Offer
</a></li><li class="dropdown-subitem"><a href="/interview/fe.html" class="nav-link">
  前端面经
</a></li><li class="dropdown-subitem"><a href="/interview/interview_guide.html" class="nav-link">
  面试导航
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/study.html" class="nav-link">
  学习笔记
</a></li></ul></li></ul></div></div> <a href="https://github.com/pengshuangbao/databook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  Java
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法 
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  架构 
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  计算机 
</a></div><div class="nav-item"><a href="/database/" class="nav-link">
  数据库 
</a></div><div class="nav-item"><a href="/fe/" class="nav-link">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维 " class="dropdown-title"><span class="title">运维 </span> <span class="arrow down"></span></button> <button type="button" aria-label="运维 " class="mobile-dropdown-title"><span class="title">运维 </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><h4>
          分类
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ops/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/ops/bigdata.html" class="nav-link">
  大数据
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/programming/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/programming/scala.html" class="nav-link">
  Scala
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><span class="title">资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="资源" class="mobile-dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          我的书单
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/tech.html" class="nav-link">
  技术类
</a></li><li class="dropdown-subitem"><a href="/book/growth.html" class="nav-link">
  成长类
</a></li></ul></li><li class="dropdown-item"><h4>
          网课
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/geek.html" class="nav-link">
  专栏
</a></li><li class="dropdown-subitem"><a href="/book/video.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/tech.html" class="nav-link">
  大厂面经
</a></li><li class="dropdown-subitem"><a href="/interview/sword-to-offer.html" class="nav-link">
  剑指Offer
</a></li><li class="dropdown-subitem"><a href="/interview/fe.html" class="nav-link">
  前端面经
</a></li><li class="dropdown-subitem"><a href="/interview/interview_guide.html" class="nav-link">
  面试导航
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/book/study.html" class="nav-link">
  学习笔记
</a></li></ul></li></ul></div></div> <a href="https://github.com/pengshuangbao/databook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/java/" aria-current="page" class="sidebar-link">Java</a></li><li><a href="/java/jvm.html" class="sidebar-link">JVM</a></li><li><a href="/java/coding.html" class="sidebar-link">编程</a></li><li><a href="/java/多线程.html" class="sidebar-link">多线程</a></li><li><a href="/java/java.html" class="sidebar-link">Java基础</a></li><li><a href="/java/java核心技术.html" class="sidebar-link">Java核心技术</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>jvm内存与垃圾回收</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/jvm内存与垃圾回收/01JVM与Java体系结构.html" class="sidebar-link">第一章、JVM与Java体系结构</a></li><li><a href="/java/jvm内存与垃圾回收/02类加载子系统.html" class="active sidebar-link">第二章、类加载子系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#内存结构概述" class="sidebar-link">内存结构概述</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#类加载器和类加载过程" class="sidebar-link">类加载器和类加载过程</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#加载-loading" class="sidebar-link">加载(Loading)</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#链接-linking" class="sidebar-link">链接(Linking)</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#初始化initialization" class="sidebar-link">初始化Initialization</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#类加载器分类" class="sidebar-link">类加载器分类</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#classloader" class="sidebar-link">ClassLoader</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#双亲委派机制" class="sidebar-link">双亲委派机制</a></li><li class="sidebar-sub-header"><a href="/java/jvm内存与垃圾回收/02类加载子系统.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/java/jvm内存与垃圾回收/03运行时数据区概念及线程.html" class="sidebar-link">第三章、运行时数据区概念及线程</a></li><li><a href="/java/jvm内存与垃圾回收/04程序计数器.html" class="sidebar-link">第四章、程序计数器(PC寄存器)</a></li><li><a href="/java/jvm内存与垃圾回收/05虚拟机栈.html" class="sidebar-link">第五章、虚拟机栈</a></li><li><a href="/java/jvm内存与垃圾回收/06本地方法接口.html" class="sidebar-link">第六章、本地方法接口</a></li><li><a href="/java/jvm内存与垃圾回收/07本地方法栈.html" class="sidebar-link">第七章、本地方法栈</a></li><li><a href="/java/jvm内存与垃圾回收/08堆.html" class="sidebar-link">第八章、堆</a></li><li><a href="/java/jvm内存与垃圾回收/09方法区.html" class="sidebar-link">第九章、方法区</a></li><li><a href="/java/jvm内存与垃圾回收/10对象实例化内存布局及访问定位.html" class="sidebar-link">第十章、对象实例化、内存布局及访问定位</a></li><li><a href="/java/jvm内存与垃圾回收/11直接内存.html" class="sidebar-link">第十一章、直接内存</a></li><li><a href="/java/jvm内存与垃圾回收/12执行引擎.html" class="sidebar-link">第十二章、执行引擎</a></li><li><a href="/java/jvm内存与垃圾回收/13StringTable.html" class="sidebar-link">第十三章、StringTable</a></li><li><a href="/java/jvm内存与垃圾回收/15垃圾回收相关算法.html" class="sidebar-link">第十五章、垃圾回收相关算法</a></li><li><a href="/java/jvm内存与垃圾回收/16垃圾回收相关概念.html" class="sidebar-link">第十六章、垃圾回收相关概念</a></li><li><a href="/java/jvm内存与垃圾回收/16垃圾回收相关概念.html" class="sidebar-link">第十六章、垃圾回收相关概念</a></li><li><a href="/java/jvm内存与垃圾回收/17垃圾回收器.html" class="sidebar-link">第十七章、垃圾回收器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jvm字节码与类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jvm性能监控与调优</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第二章、类加载子系统"><a href="#第二章、类加载子系统" class="header-anchor">#</a> 第二章、类加载子系统</h1> <p></p><div class="table-of-contents"><ul><li><a href="#内存结构概述">内存结构概述</a></li><li><a href="#类加载器和类加载过程">类加载器和类加载过程</a><ul><li><a href="#反编译后的常量池">反编译后的常量池</a></li><li><a href="#类加载器classloader扮演的角色">类加载器ClassLoader扮演的角色</a></li><li><a href="#类加载过程">类加载过程</a></li></ul></li><li><a href="#加载-loading">加载(Loading)</a></li><li><a href="#链接-linking">链接(Linking)</a><ul><li><a href="#验证verify">验证Verify</a></li><li><a href="#准备prepare">准备Prepare</a></li><li><a href="#解析resolve">解析Resolve</a></li></ul></li><li><a href="#初始化initialization">初始化Initialization</a><ul><li><a href="#举例1-简单">举例1-简单</a></li><li><a href="#举例2-复杂">举例2-复杂</a></li><li><a href="#举例3-顺序">举例3-顺序</a></li><li><a href="#注意-不能前向引用">注意:不能前向引用</a></li><li><a href="#类构造器">类构造器</a></li><li><a href="#加载顺序-子类在加载之前-先保证父类的加载">加载顺序 子类在加载之前，先保证父类的加载</a></li></ul></li><li><a href="#类加载器分类">类加载器分类</a><ul><li><a href="#虚拟机自带的加载器">虚拟机自带的加载器</a></li><li><a href="#_2-3-2-用户自定义类加载器">2.3.2. 用户自定义类加载器</a></li><li><a href="#举例-启动类加载器">举例-启动类加载器</a></li><li><a href="#举例-扩展类加载器">举例-扩展类加载器</a></li></ul></li><li><a href="#classloader">ClassLoader</a></li><li><a href="#双亲委派机制">双亲委派机制</a><ul><li><a href="#什么是双亲委派机制">什么是双亲委派机制？</a></li><li><a href="#工作原理">工作原理</a></li><li><a href="#举例-string">举例-String</a></li><li><a href="#优势">优势</a><ul><li><a href="#举例-保护系统">举例 保护系统</a></li><li><a href="#沙箱安全机制">沙箱安全机制</a></li></ul></li></ul></li><li><a href="#其他">其他</a><ul><li><a href="#类class相同的条件">类Class相同的条件</a></li><li><a href="#一个类到另外一个类的引用。两者的类加载器需要一样">一个类到另外一个类的引用。两者的类加载器需要一样</a></li><li><a href="#主动使用和被动使用">主动使用和被动使用</a></li></ul></li></ul></div><p></p> <h2 id="内存结构概述"><a href="#内存结构概述" class="header-anchor">#</a> 内存结构概述</h2> <p><img src="https://static.lovedata.net/20-11-08-dfaa6fbb50eaf3377cdb10d8c1656e00.png" alt="image"></p> <ul><li>Class文件</li> <li><mark>类加载子系统</mark></li> <li>运行时数据区
<ul><li>方法区</li> <li>堆</li> <li>程序计数器</li> <li>虚拟机栈</li> <li>本地方法栈</li></ul></li> <li>执行引擎</li> <li>本地方法接口</li> <li>本地方法库</li></ul> <p><img src="https://static.lovedata.net/20-11-09-d5b3896a485664f3749779daa78424ff.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-3505d0448c17eea52665c6f5f2a71806.png" alt="image"></p> <h2 id="类加载器和类加载过程"><a href="#类加载器和类加载过程" class="header-anchor">#</a> 类加载器和类加载过程</h2> <p><img src="https://static.lovedata.net/20-11-08-8d711718f5329837e107ea6e944468f1.png" alt="image"></p> <ul><li>类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识。</li> <li>ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</li> <li>加载的类信息存放于一块称为方法区的内存空间。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量（这部分常量信息是Class文件中常量池部分的内存映射）</li></ul> <h3 id="反编译后的常量池"><a href="#反编译后的常量池" class="header-anchor">#</a> 反编译后的常量池</h3> <p><img src="https://static.lovedata.net/20-11-08-6f133287491c5248e48e60320d0e61fd.png" alt="image"></p> <h3 id="类加载器classloader扮演的角色"><a href="#类加载器classloader扮演的角色" class="header-anchor">#</a> 类加载器ClassLoader扮演的角色</h3> <p><img src="https://static.lovedata.net/20-11-08-22b593b502e832600fdff00c60464c75.png" alt="image"></p> <ul><li>class file存在于本地硬盘上，可以理解为设计师画在纸上的模板，而最终这个模板在执行的时候是要加载到JVM当中来根据这个文件实例化出n个一模一样的实例。</li> <li>class file加载到JVM中，被称为DNA元数据模板，放在方法区。</li> <li>在.class文件-&gt;JVM-&gt;最终成为元数据模板，此过程就要一个运输工具（类装载器Class Loader），扮演一个快递员的角色。</li></ul> <h3 id="类加载过程"><a href="#类加载过程" class="header-anchor">#</a> 类加载过程</h3> <p><img src="https://static.lovedata.net/20-11-08-4226feb63f7286a072c1a091ed6d6f08.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-d22108a7c441abf16c82fc4f82d8ad59.png" alt="image"></p> <h2 id="加载-loading"><a href="#加载-loading" class="header-anchor">#</a> 加载(Loading)</h2> <p><img src="https://static.lovedata.net/20-11-08-f3613061e2894a89a139ad02c1e2c187.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-bd5f18c9587c55ebc9522cea44639489.png" alt="image"></p> <ul><li><ol><li>通过一个类的全限定名获取定义此类的二进制字节流</li></ol></li> <li><ol start="2"><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li></ol></li> <li><ol start="3"><li>在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口</li></ol></li></ul> <p><strong>补充：加载class文件的方式</strong></p> <ul><li>从<mark>本地系统</mark>中直接加载</li> <li>通过<mark>网络</mark>获取，典型场景：Web Applet</li> <li>从zip<mark>压缩包</mark>中读取，成为日后jar、war格式的基础</li> <li>运行时计算生成，使用最多的是：<mark>动态代理技术</mark></li> <li>由其他文件生成，典型场景：<mark>JSP应用</mark></li> <li>从专有<mark>数据库</mark>中提取.class文件，比较少见</li> <li>从<mark>加密文件</mark>中获取，典型的防Class文件被反编译的保护措施</li></ul> <h2 id="链接-linking"><a href="#链接-linking" class="header-anchor">#</a> 链接(Linking)</h2> <p><img src="https://static.lovedata.net/20-11-08-6f358e1875ac795e6250c81b1c01c826.png" alt="image"></p> <ul><li><strong>验证（Verify）</strong>：
<ul><li>目的在子确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全。</li> <li>主要包括四种验证，<mark>文件格式验证，元数据验证，字节码验证，符号引用验证。</mark></li></ul></li> <li><strong>准备（Prepare）</strong>：
<ul><li>为类变量分配内存并且设置该类变量的默认初始值，即零值。</li> <li><mark>这里不包含用final修饰的static，因为final在编译的时候就会分配了，准备阶段会显式初始化；</mark></li> <li><mark>这里不会为实例变量分配初始化</mark>，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中。</li></ul></li> <li><strong>解析（Resolve）</strong>：
<ul><li>将常量池内的<mark>符号引用转换为直接引用</mark>的过程。</li> <li>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行。</li> <li>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的Class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。</li> <li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT_Class_info，CONSTANT_Fieldref_info、CONSTANT_Methodref_info等。</li></ul></li></ul> <h3 id="验证verify"><a href="#验证verify" class="header-anchor">#</a> 验证Verify</h3> <h3 id="准备prepare"><a href="#准备prepare" class="header-anchor">#</a> 准备Prepare</h3> <p><img src="https://static.lovedata.net/20-11-08-9256bdab3fa10a2c2cc67cb416861163.png" alt="image"></p> <h3 id="解析resolve"><a href="#解析resolve" class="header-anchor">#</a> 解析Resolve</h3> <p>后面详细说明</p> <h2 id="初始化initialization"><a href="#初始化initialization" class="header-anchor">#</a> 初始化Initialization</h2> <blockquote><p>如果类中没有 类变量的赋值动作和静态代码块，则不会生成 clinit方法，但是任何类都会有一个默认的类构造器</p></blockquote> <p><img src="https://static.lovedata.net/20-11-08-582454073500a7880792b366cd35be25.png" alt="image"></p> <ul><li><mark>初始化阶段就是执行类构造器方法&lt;clinit&gt;()的过程。</mark></li> <li>此方法不需定义，是javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来。</li> <li>构造器方法中指令按语句在源文件中出现的顺序执行。</li> <li><mark>&lt;clinit&gt;()不同于类的构造器。</mark>（关联：构造器是虚拟机视角下的&lt;init&gt;()）</li> <li>若该类具有父类，JVM会保证子类的&lt;clinit&gt;()执行前，父类的&lt;clinit&gt;()已经执行完毕。</li> <li>虚拟机必须保证一个类的&lt;clinit&gt;()方法在多线程下被同步加锁。</li></ul> <h3 id="举例1-简单"><a href="#举例1-简单" class="header-anchor">#</a> 举例1-简单</h3> <p><img src="https://static.lovedata.net/20-11-08-57159b39f018cdcb01d459c000e2da79.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-d03d9226f8d4b0ade44eba6686733ca7.png" alt="image"></p> <h3 id="举例2-复杂"><a href="#举例2-复杂" class="header-anchor">#</a> 举例2-复杂</h3> <p><img src="https://static.lovedata.net/20-11-08-7ad66ef2951ca76ab342ae6737ec46e5.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-3a5e1a807771464feaa3efc0bf0b1359.png" alt="image"></p> <h3 id="举例3-顺序"><a href="#举例3-顺序" class="header-anchor">#</a> 举例3-顺序</h3> <p>因为在 linkking的prepare阶段，number已经被赋初始值为0了，然后初始化顺序又是根据代码顺序来的，所以先会被初始化为20，然后又会被初始化为10，所以最后的值就是10</p> <p><img src="https://static.lovedata.net/20-11-08-e956d27a3eecb3aad57d7c0113e429ae.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-b9e1a8fd5eda6368ed20d4ba122c3338.png" alt="image"></p> <h3 id="注意-不能前向引用"><a href="#注意-不能前向引用" class="header-anchor">#</a> 注意:不能前向引用</h3> <p><img src="https://static.lovedata.net/20-11-08-6408621c141eae872b02753dacd22572.png" alt="image"></p> <h3 id="类构造器"><a href="#类构造器" class="header-anchor">#</a> 类构造器</h3> <p><img src="https://static.lovedata.net/20-11-08-00b8fc89af64eb9952ec41e8aa6a50e8.png" alt="image"></p> <h3 id="加载顺序-子类在加载之前-先保证父类的加载"><a href="#加载顺序-子类在加载之前-先保证父类的加载" class="header-anchor">#</a> 加载顺序 子类在加载之前，先保证父类的加载</h3> <p><img src="https://static.lovedata.net/20-11-08-8ba084b0f75994aae1497aa8a3ae1e82.png" alt="image"></p> <h2 id="类加载器分类"><a href="#类加载器分类" class="header-anchor">#</a> 类加载器分类</h2> <p><img src="https://static.lovedata.net/20-11-08-89fc42386a45978b31d3bef835a9a999.png" alt="image"></p> <p>JVM支持两种类型的类加载器 。分别为<mark>引导类加载器（Bootstrap ClassLoader）</mark>和<mark>自定义类加载器（User-Defined ClassLoader）</mark>。</p> <p>从概念上来讲，自定义类加载器一般指的是程序中由开发人员自定义的一类类加载器，但是Java虚拟机规范却没有这么定义，而是将<mark>所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器</mark>。</p> <p>无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终只有3个，如下所示：</p> <p><strong>不是继承关系</strong></p> <blockquote><p>BootstrapClassLoader 不是java语言写的，其他的都是java语言</p></blockquote> <p><img src="https://static.lovedata.net/20-11-08-d65192d286a1e889310b9f158ff0927e.png" alt="image"></p> <blockquote><p><strong>他们之间是层次关系，不是继承关系</strong></p></blockquote> <p><img src="https://static.lovedata.net/20-11-08-a19f2e8aded132b877f01d58328a0ac7.png" alt="image"></p> <blockquote><p>引导类加载器只加载核心的类库，普通的是不管你的哟，</p></blockquote> <p><img src="https://static.lovedata.net/20-11-08-d97a71d3e9d672278600239023d4be4f.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-e2db39763f634d85d7bfd65c1b0cb698.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-05bf18f0ceb18ee952d20164706c8cac.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-22b1bf2ee94b8eed61c1b689ab6544ff.png" alt="image"></p> <h3 id="虚拟机自带的加载器"><a href="#虚拟机自带的加载器" class="header-anchor">#</a> 虚拟机自带的加载器</h3> <p><strong>启动类加载器（引导类加载器，Bootstrap ClassLoader）</strong></p> <ul><li>这个类加载使用C/C++语言实现的，嵌套在JVM内部。</li> <li>它用来加载Java的核心库（JAVA_HOME/jre/lib/rt.jar、resources.jar或sun.boot.class.path路径下的内容），用于提供JVM自身需要的类</li> <li>并不继承自ava.lang.ClassLoader，没有父加载器。</li> <li>加载扩展类和应用程序类加载器，并指定为他们的父类加载器。</li> <li>出于安全考虑，Bootstrap启动类加载器只加载包名为java、javax、sun等开头的类</li></ul> <p><strong>扩展类加载器（Extension ClassLoader）</strong></p> <ul><li>Java语言编写，由sun.misc.Launcher$ExtClassLoader实现。</li> <li>派生于ClassLoader类</li> <li>父类加载器为启动类加载器</li> <li>从java.ext.dirs系统属性所指定的目录中加载类库，或从JDK的安装目录的jre/1ib/ext子目录（扩展目录）下加载类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载。</li></ul> <p><strong>应用程序类加载器（系统类加载器，AppClassLoader）</strong></p> <ul><li>java语言编写，由sun.misc.LaunchersAppClassLoader实现</li> <li>派生于ClassLoader类</li> <li>父类加载器为扩展类加载器</li> <li>它负责加载环境变量classpath或系统属性java.class.path指定路径下的类库</li> <li><mark>该类加载是程序中默认的类加载器</mark>，一般来说，Java应用的类都是由它来完成加载</li> <li>通过ClassLoader#getSystemclassLoader() 方法可以获取到该类加载器</li></ul> <h3 id="_2-3-2-用户自定义类加载器"><a href="#_2-3-2-用户自定义类加载器" class="header-anchor">#</a> 2.3.2. 用户自定义类加载器</h3> <p>在Java的日常应用程序开发中，类的加载几乎是由上述3种类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方式。 为什么要自定义类加载器？</p> <ul><li>隔离加载类</li> <li>修改类加载的方式</li> <li>扩展加载源</li> <li>防止源码泄漏</li></ul> <p>用户自定义类加载器实现步骤：</p> <ol><li>开发人员可以通过继承抽象类ava.lang.ClassLoader类的方式，实现自己的类加载器，以满足一些特殊的需求</li> <li>在JDK1.2之前，在自定义类加载器时，总会去继承ClassLoader类并重写loadClass() 方法，从而实现自定义的类加载类，但是在JDK1.2之后已不再建议用户去覆盖loadclass() 方法，而是建议把自定义的类加载逻辑写在findClass()方法中</li> <li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承URLClassLoader类，这样就可以避免自己去编写findClass()  方法及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li></ol> <h3 id="举例-启动类加载器"><a href="#举例-启动类加载器" class="header-anchor">#</a> 举例-启动类加载器</h3> <p><img src="https://static.lovedata.net/20-11-08-355b8c222bcbfd81a563bffd0d35c61f.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-7d610410a9ec5ce75d871447e22a8231.png" alt="image"></p> <h3 id="举例-扩展类加载器"><a href="#举例-扩展类加载器" class="header-anchor">#</a> 举例-扩展类加载器</h3> <p><img src="https://static.lovedata.net/20-11-08-8065dc042526778c1b33a985f0887180.png" alt="image"></p> <h2 id="classloader"><a href="#classloader" class="header-anchor">#</a> ClassLoader</h2> <p>ClassLoader类是一个抽象类，其后所有的类加载器都继承自ClassLoader（不包括启动类加载器）</p> <p><img src="https://static.lovedata.net/20-11-08-451fb2ce7f0922abc9c9dc1085c6cd0a.png" alt="image"></p> <p><img src="https://static.lovedata.net/20-11-08-cdd283713d605b8cf4a255c7dfe8d207.png" alt="image"></p> <p><strong>获取ClassLoader的途径</strong></p> <ul><li><p>方式一：获取当前ClassLoader</p> <div class="language-java extra-class"><pre class="language-java"><code>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>方式二：获取当前线程上下文的ClassLoader</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>方式三：获取系统的ClassLoader</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>方式四：获取调用者的ClassLoader</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getCallerClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h2> <h3 id="什么是双亲委派机制"><a href="#什么是双亲委派机制" class="header-anchor">#</a> 什么是双亲委派机制？</h3> <p><img src="https://static.lovedata.net/20-11-08-adb15cfe06756dd9a4ba2446c571c56a.png" alt="image"></p> <p>Java虚拟机对class文件采用的是<mark>按需加载</mark>的方式，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且加载某个类的class文件时，Java虚拟机采用的是<mark>双亲委派模式</mark>，即把请求交由父类处理，它是一种任务委派模式。</p> <p><strong>工作原理</strong></p> <ul><li>1）如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</li> <li>2）如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</li> <li>3）如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。</li></ul> <h3 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h3> <ul><li>类加载请求</li> <li>自己先不加载，给父类</li> <li>还不存在，则依次往上递归，知道引导类加载器</li></ul> <p><img src="https://static.lovedata.net/20-11-08-06511c3165bc59d01af8a575f0a64328.png" alt="image"></p> <h3 id="举例-string"><a href="#举例-string" class="header-anchor">#</a> 举例-String</h3> <p><img src="https://static.lovedata.net/20-11-08-024cff71de258b53ea2833c8f596be1c.png" alt="image"></p> <p>当我们加载jdbc.jar 用于实现数据库连接的时候，首先我们需要知道的是 jdbc.jar是基于SPI接口进行实现的，所以在加载的时候，会进行双亲委派，最终从根加载器中加载 SPI核心类，然后在加载SPI接口类，接着在进行反向委派，通过线程上下文类加载器进行实现类jdbc.jar的加载。</p> <h3 id="优势"><a href="#优势" class="header-anchor">#</a> 优势</h3> <ul><li>避免类的重复加载</li> <li>保护程序安全，防止核心API被随意篡改
<ul><li>自定义类：java.lang.String</li> <li>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</li></ul></li></ul> <p><img src="https://static.lovedata.net/20-11-08-46c7bbc340dc1188188df317dc62f365.png" alt="image"></p> <h4 id="举例-保护系统"><a href="#举例-保护系统" class="header-anchor">#</a> 举例 保护系统</h4> <p><img src="https://static.lovedata.net/20-11-08-9827418498f25e35c4a9ac8526410f06.png" alt="image"></p> <h4 id="沙箱安全机制"><a href="#沙箱安全机制" class="header-anchor">#</a> 沙箱安全机制</h4> <p>自定义String类，但是在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java\lang\String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的string类。这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</p> <p><img src="https://static.lovedata.net/20-11-08-aca0d107143a0d1c4af5a60547953868.png" alt="image"></p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p><strong>如何判断两个class对象是否相同</strong></p> <p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p> <ul><li>类的完整类名必须一致，包括包名。</li> <li>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同。</li></ul> <p>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的。</p> <p><strong>对类加载器的引用</strong></p> <p>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的。如果一个类型是由用户类加载器加载的，那么JVM会<mark>将这个类加载器的一个引用作为类型信息的一部分保存在方法区中</mark>。当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的。</p> <p><strong>类的主动使用和被动使用</strong></p> <p>Java程序对类的使用方式分为：主动使用和被动使用。</p> <p>主动使用，又分为七种情况：</p> <ul><li><p>创建类的实例</p></li> <li><p>访问某个类或接口的静态变量，或者对该静态变量赋值</p></li> <li><p>调用类的静态方法</p></li> <li><p>反射（比如：Class.forName（&quot;com.atguigu.Test&quot;））</p></li> <li><p>初始化一个类的子类</p></li> <li><p>Java虚拟机启动时被标明为启动类的类</p></li> <li><p>JDK 7 开始提供的动态语言支持：</p> <p>java.lang.invoke.MethodHandle实例的解析结果</p> <p>REF_getStatic、REF_putStatic、REF_invokeStatic句柄对应的类没有初始化，则初始化</p></li></ul> <p>除了以上七种情况，其他使用Java类的方式都被看作是对<mark>类的被动使用</mark>，都<mark>不会导致类的初始化</mark>。</p> <h3 id="类class相同的条件"><a href="#类class相同的条件" class="header-anchor">#</a> 类Class相同的条件</h3> <p><img src="https://static.lovedata.net/20-11-08-0a4e3823bf51e1e6de91d0b094b746de.png" alt="image"></p> <h3 id="一个类到另外一个类的引用。两者的类加载器需要一样"><a href="#一个类到另外一个类的引用。两者的类加载器需要一样" class="header-anchor">#</a> 一个类到另外一个类的引用。两者的类加载器需要一样</h3> <p><img src="https://static.lovedata.net/20-11-08-1a310e2ee14faef204decfb7af2c5b02.png" alt="image"></p> <h3 id="主动使用和被动使用"><a href="#主动使用和被动使用" class="header-anchor">#</a> 主动使用和被动使用</h3> <p><img src="https://static.lovedata.net/20-11-08-a04847bc0a7a66c17c949d2cbf139ffb.png" alt="image"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/pengshuangbao/databook/edit/master/docs/java/jvm内存与垃圾回收/02类加载子系统.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/4/14 16:56:47</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/jvm内存与垃圾回收/01JVM与Java体系结构.html" class="prev">
        第一章、JVM与Java体系结构
      </a></span> <span class="next"><a href="/java/jvm内存与垃圾回收/03运行时数据区概念及线程.html">
        第三章、运行时数据区概念及线程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.0f56a723.js" defer></script><script src="/assets/js/4.a8ef5668.js" defer></script><script src="/assets/js/149.4b9796c2.js" defer></script><script src="/assets/js/11.0473ae06.js" defer></script>
  </body>
</html>

(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{597:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络"}},[t._v("#")]),t._v(" 网络")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#iptables"}},[t._v("iptables")]),s("ul",[s("li",[s("a",{attrs:{href:"#i-tables常用参数"}},[t._v("I-tables常用参数")])]),s("li",[s("a",{attrs:{href:"#常用命令"}},[t._v("常用命令")]),s("ul",[s("li",[s("a",{attrs:{href:"#查看已有的防火墙规则链"}},[t._v("查看已有的防火墙规则链")])]),s("li",[s("a",{attrs:{href:"#清空已有的防火墙规则链"}},[t._v("清空已有的防火墙规则链")])]),s("li",[s("a",{attrs:{href:"#把input规则链的默认策略设置为拒绝"}},[t._v("把INPUT规则链的默认策略设置为拒绝")])]),s("li",[s("a",{attrs:{href:"#向input链中添加允许icmp流量进入策略规则"}},[t._v("向INPUT链中添加允许ICMP流量进入策略规则")])]),s("li",[s("a",{attrs:{href:"#将input规则链设置为只允许指定网段的主机访问本机的22端口-拒绝来自其他所有主机的流量"}},[t._v("将INPUT规则链设置为只允许指定网段的主机访问本机的22端口，拒绝来自其他所有主机的流量：")])]),s("li",[s("a",{attrs:{href:"#向input规则链中添加拒绝所有人访问本机12345端口的策略规则"}},[t._v("向INPUT规则链中添加拒绝所有人访问本机12345端口的策略规则：")])]),s("li",[s("a",{attrs:{href:"#向input规则链中添加拒绝192-168-10-5主机访问本机80端口-web服务-的策略规则"}},[t._v("向INPUT规则链中添加拒绝192.168.10.5主机访问本机80端口（Web服务）的策略规则：")])]),s("li",[s("a",{attrs:{href:"#向input规则链中添加拒绝所有主机访问本机1000-1024端口的策略规则"}},[t._v("向INPUT规则链中添加拒绝所有主机访问本机1000～1024端口的策略规则：")])]),s("li",[s("a",{attrs:{href:"#让iptables防火墙立即生效"}},[t._v("让iptables防火墙立即生效")])])])])])]),s("li",[s("a",{attrs:{href:"#firewalld"}},[t._v("firewalld")]),s("ul",[s("li",[s("a",{attrs:{href:"#常用区域"}},[t._v("常用区域")])]),s("li",[s("a",{attrs:{href:"#firewall-cmd命令行参数和作用"}},[t._v("Firewall-cmd命令行参数和作用")])]),s("li",[s("a",{attrs:{href:"#常用命令"}},[t._v("常用命令")]),s("ul",[s("li",[s("a",{attrs:{href:"#查看firewalld服务当前所使用的区域"}},[t._v("查看firewalld服务当前所使用的区域：")])])])])])]),s("li",[s("a",{attrs:{href:"#https"}},[t._v("https")])]),s("li",[s("a",{attrs:{href:"#题目"}},[t._v("题目")]),s("ul",[s("li",[s("a",{attrs:{href:"#tcp灵魂之问-https-mp-weixin-qq-com-s-2rnhbjxhm2lt1o-qvieo6q"}},[t._v("[TCP灵魂之问](https://mp.weixin.qq.com/s/2RnhbJxHm2lt1o-qvIEo6Q)")]),s("ul",[s("li",[s("a",{attrs:{href:"#说说-tcp-三次握手的过程-为什么是三次而不是两次、四次"}},[t._v("说说 TCP 三次握手的过程？为什么是三次而不是两次、四次？")])]),s("li",[s("a",{attrs:{href:"#四次挥手"}},[t._v("四次挥手")])])])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"iptables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[t._v("#")]),t._v(" iptables")]),t._v(" "),s("h3",{attrs:{id:"i-tables常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#i-tables常用参数"}},[t._v("#")]),t._v(" I-tables常用参数")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-01-21-7fff7d1b872ba63ab9a9a4375fd733a9.png",alt:"image"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-01-21-5373e11dfc760d54949dc30b425ec96a.png",alt:"image"}})]),t._v(" "),s("h3",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("⚠️注意：防火墙策略规则是从上到下的顺序匹配，因此一定要把允许动作放到拒绝动作前面，否则所有流量都会被拒绝掉")])]),t._v(" "),s("h4",{attrs:{id:"查看已有的防火墙规则链"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看已有的防火墙规则链"}},[t._v("#")]),t._v(" 查看已有的防火墙规则链")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -L\n")])])]),s("h4",{attrs:{id:"清空已有的防火墙规则链"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清空已有的防火墙规则链"}},[t._v("#")]),t._v(" 清空已有的防火墙规则链")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -F\niptables -L\n")])])]),s("h4",{attrs:{id:"把input规则链的默认策略设置为拒绝"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#把input规则链的默认策略设置为拒绝"}},[t._v("#")]),t._v(" 把INPUT规则链的默认策略设置为拒绝")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -P INPUT DROP\n")])])]),s("h4",{attrs:{id:"向input链中添加允许icmp流量进入策略规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#向input链中添加允许icmp流量进入策略规则"}},[t._v("#")]),t._v(" 向INPUT链中添加允许ICMP流量进入策略规则")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptalbes -I INPUT -p icmp -j ACCEPT\n")])])]),s("h4",{attrs:{id:"将input规则链设置为只允许指定网段的主机访问本机的22端口-拒绝来自其他所有主机的流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将input规则链设置为只允许指定网段的主机访问本机的22端口-拒绝来自其他所有主机的流量"}},[t._v("#")]),t._v(" 将INPUT规则链设置为只允许指定网段的主机访问本机的22端口，拒绝来自其他所有主机的流量：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -I INPUT -s "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".10.0/24 -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\niptables -A INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j REJECT\n")])])]),s("h4",{attrs:{id:"向input规则链中添加拒绝所有人访问本机12345端口的策略规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#向input规则链中添加拒绝所有人访问本机12345端口的策略规则"}},[t._v("#")]),t._v(" 向INPUT规则链中添加拒绝所有人访问本机12345端口的策略规则：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -I INPUT -p tcp -dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12345")]),t._v(" -j REJECT\niptables -I INPUT -p udp -dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12345")]),t._v(" -j REJECT\n")])])]),s("h4",{attrs:{id:"向input规则链中添加拒绝192-168-10-5主机访问本机80端口-web服务-的策略规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#向input规则链中添加拒绝192-168-10-5主机访问本机80端口-web服务-的策略规则"}},[t._v("#")]),t._v(" 向INPUT规则链中添加拒绝192.168.10.5主机访问本机80端口（Web服务）的策略规则：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -I INPUT -p tcp -s "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".10.5 --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j REJECT\n")])])]),s("h4",{attrs:{id:"向input规则链中添加拒绝所有主机访问本机1000-1024端口的策略规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#向input规则链中添加拒绝所有主机访问本机1000-1024端口的策略规则"}},[t._v("#")]),t._v(" 向INPUT规则链中添加拒绝所有主机访问本机1000～1024端口的策略规则：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("iptables -i INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(":1024 -j REJECT\niptables -i INPUT -p udp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(":1024 -j REJECT\n")])])]),s("h4",{attrs:{id:"让iptables防火墙立即生效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#让iptables防火墙立即生效"}},[t._v("#")]),t._v(" 让iptables防火墙立即生效")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" iptables save\n")])])]),s("h2",{attrs:{id:"firewalld"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#firewalld"}},[t._v("#")]),t._v(" firewalld")]),t._v(" "),s("h3",{attrs:{id:"常用区域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用区域"}},[t._v("#")]),t._v(" 常用区域")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-01-22-6302aa42576353b0606bc6614d9368e6.png",alt:"image"}})]),t._v(" "),s("h3",{attrs:{id:"firewall-cmd命令行参数和作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#firewall-cmd命令行参数和作用"}},[t._v("#")]),t._v(" Firewall-cmd命令行参数和作用")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-01-22-402a9c106b7897ef832d5d7a94a7ede8.png",alt:"image"}})]),t._v(" "),s("h3",{attrs:{id:"常用命令-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-2"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),s("h4",{attrs:{id:"查看firewalld服务当前所使用的区域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看firewalld服务当前所使用的区域"}},[t._v("#")]),t._v(" 查看firewalld服务当前所使用的区域：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("firewall-cmd --get-default-zone\n")])])]),s("h2",{attrs:{id:"https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" https")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/-o2FDyUuECZhHCIOJsesNA",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么https是安全的"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"题目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#题目"}},[t._v("#")]),t._v(" 题目")]),t._v(" "),s("h3",{attrs:{id:"tcp灵魂之问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp灵魂之问"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://mp.weixin.qq.com/s/2RnhbJxHm2lt1o-qvIEo6Q",target:"_blank",rel:"noopener noreferrer"}},[t._v("TCP灵魂之问"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"说说-tcp-三次握手的过程-为什么是三次而不是两次、四次"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说说-tcp-三次握手的过程-为什么是三次而不是两次、四次"}},[t._v("#")]),t._v(" 说说 TCP 三次握手的过程？为什么是三次而不是两次、四次？")]),t._v(" "),s("blockquote",[s("p",[t._v("恋爱模拟")]),t._v(" "),s("p",[t._v("第一次:")]),t._v(" "),s("p",[t._v("男: "),s("strong",[t._v("我爱你。")])]),t._v(" "),s("p",[t._v("女方收到。")]),t._v(" "),s("p",[t._v("由此证明男方拥有"),s("code",[t._v("爱")]),t._v("的能力。")]),t._v(" "),s("p",[t._v("第二次:")]),t._v(" "),s("p",[t._v("女: "),s("strong",[t._v("我收到了你的爱，我也爱你。")])]),t._v(" "),s("p",[t._v("男方收到。")]),t._v(" "),s("p",[t._v("OK，现在的情况说明，女方拥有"),s("code",[t._v("爱")]),t._v("和"),s("code",[t._v("被爱")]),t._v("的能力。")]),t._v(" "),s("p",[t._v("第三次:")]),t._v(" "),s("p",[t._v("男: "),s("strong",[t._v("我收到了你的爱。")])]),t._v(" "),s("p",[t._v("女方收到。")]),t._v(" "),s("p",[t._v("现在能够保证男方具备"),s("code",[t._v("被爱")]),t._v("的能力。")]),t._v(" "),s("p",[t._v("由此完整地确认了双方"),s("code",[t._v("爱")]),t._v("和"),s("code",[t._v("被爱")]),t._v("的能力，两人开始一段甜蜜的爱情。")])]),t._v(" "),s("p",[t._v("对应到 TCP 的三次握手，也是需要确认双方的两样能力: "),s("code",[t._v("发送的能力")]),t._v("和"),s("code",[t._v("接收的能力")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-04-02-69b4951df2e7b1f9326e3671f251fb28.png",alt:"image"}})]),t._v(" "),s("p",[t._v("从最开始双方都处于"),s("code",[t._v("CLOSED")]),t._v("状态。然后服务端开始监听某个端口，进入了"),s("code",[t._v("LISTEN")]),t._v("状态。")]),t._v(" "),s("p",[t._v("然后客户端主动发起连接，发送 SYN , 自己变成了"),s("code",[t._v("SYN-SENT")]),t._v("状态。")]),t._v(" "),s("p",[t._v("服务端接收到，返回"),s("code",[t._v("SYN")]),t._v("和"),s("code",[t._v("ACK")]),t._v("(对应客户端发来的SYN)，自己变成了"),s("code",[t._v("SYN-REVD")]),t._v("。")]),t._v(" "),s("p",[t._v("之后客户端再发送"),s("code",[t._v("ACK")]),t._v("给服务端，自己变成了"),s("code",[t._v("ESTABLISHED")]),t._v("状态；服务端收到"),s("code",[t._v("ACK")]),t._v("之后，也变成了"),s("code",[t._v("ESTABLISHED")]),t._v("状态。")]),t._v(" "),s("p",[t._v("SYN 是需要消耗一个序列号的，下次发送对应的 ACK 序列号要加1，为什么呢？只需要记住一个规则:")]),t._v(" "),s("blockquote",[s("p",[t._v("凡是需要对端确认的，一定消耗TCP报文的序列号")])]),t._v(" "),s("p",[s("strong",[t._v("SYN 需要对端的确认， 而 ACK 并不需要，因此 SYN 消耗一个序列号而 ACK 不需要")])]),t._v(" "),s("h4",{attrs:{id:"四次挥手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[t._v("#")]),t._v(" 四次挥手")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-04-02-5946e08e1f8e0d944d23b165d9de23e6.png",alt:"image"}})]),t._v(" "),s("p",[t._v("刚开始双方处于"),s("code",[t._v("ESTABLISHED")]),t._v("状态。")]),t._v(" "),s("p",[t._v("客户端要断开了，向服务器发送 "),s("code",[t._v("FIN")]),t._v(" 报文，在 TCP 报文中的位置如下图:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.lovedata.net/21-04-02-b49eb4eeecbc3af98841882e060817b9.png",alt:"image"}})]),t._v(" "),s("p",[t._v("发送后客户端变成了"),s("code",[t._v("FIN-WAIT-1")]),t._v("状态。注意, 这时候客户端同时也变成了"),s("code",[t._v("half-close(半关闭)")]),t._v("状态，即无法向服务端发送报文，只能接收。")]),t._v(" "),s("p",[t._v("服务端接收后向客户端确认，变成了"),s("code",[t._v("CLOSED-WAIT")]),t._v("状态。")]),t._v(" "),s("p",[t._v("客户端接收到了服务端的确认，变成了"),s("code",[t._v("FIN-WAIT2")]),t._v("状态。")]),t._v(" "),s("p",[t._v("随后，服务端向客户端发送"),s("code",[t._v("FIN")]),t._v("，自己进入"),s("code",[t._v("LAST-ACK")]),t._v("状态，")]),t._v(" "),s("p",[t._v("客户端收到服务端发来的"),s("code",[t._v("FIN")]),t._v("后，自己变成了"),s("code",[t._v("TIME-WAIT")]),t._v("状态，然后发送 ACK 给服务端。")]),t._v(" "),s("p",[t._v("注意了，这个时候，客户端需要等待足够长的时间，具体来说，是 2 个 "),s("code",[t._v("MSL")]),t._v("("),s("code",[t._v("Maximum Segment Lifetime，报文最大生存时间")]),t._v("), 在这段时间内如果客户端没有收到服务端的重发请求，那么表示 ACK 成功到达，挥手结束，否则客户端重发 ACK。")])])}),[],!1,null,null,null);a.default=r.exports}}]);